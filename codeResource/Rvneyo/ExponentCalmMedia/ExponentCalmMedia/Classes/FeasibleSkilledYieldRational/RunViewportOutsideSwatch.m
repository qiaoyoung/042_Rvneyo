
#import <Foundation/Foundation.h>

NSString *StringFromSubtle_Data(Byte *data);


//: fired
Byte userDomeTimer[] = {76, 5, 49, 12, 228, 204, 108, 162, 103, 242, 204, 81, 151, 154, 163, 150, 149, 39};

//: session_snapchat_other_readed
Byte k_radarEvent[] = {16, 29, 81, 8, 73, 239, 212, 223, 196, 182, 196, 196, 186, 192, 191, 176, 196, 191, 178, 193, 180, 185, 178, 197, 176, 192, 197, 185, 182, 195, 176, 195, 182, 178, 181, 182, 181, 13};

//: session_snapchat_self_unread
Byte dataEpisodeAlert[] = {16, 28, 8, 7, 90, 92, 247, 123, 109, 123, 123, 113, 119, 118, 103, 123, 118, 105, 120, 107, 112, 105, 124, 103, 123, 109, 116, 110, 103, 125, 118, 122, 109, 105, 108, 73};

//: HEIC
Byte componentOwlDict[] = {76, 4, 61, 4, 133, 130, 134, 128, 54};

//: session_snapchat_other_unread
Byte styleMarkPlatform[] = {82, 29, 90, 12, 172, 81, 49, 210, 91, 232, 92, 177, 205, 191, 205, 205, 195, 201, 200, 185, 205, 200, 187, 202, 189, 194, 187, 206, 185, 201, 206, 194, 191, 204, 185, 207, 200, 204, 191, 187, 190, 153};

//: md5
Byte colorStarFormat[] = {84, 3, 3, 10, 66, 71, 43, 24, 2, 190, 112, 103, 56, 14};

//: jpg
Byte colorShiftTitle[] = {79, 3, 1, 13, 92, 244, 4, 178, 37, 144, 156, 211, 240, 107, 113, 104, 82};

//: data
Byte widgetUrbanDict[] = {17, 4, 14, 8, 36, 181, 178, 152, 114, 111, 130, 111, 188};

//: url
Byte cacheOutlineDate[] = {48, 3, 99, 10, 82, 140, 53, 125, 194, 223, 216, 213, 207, 63};

//: type
Byte componentCropID[] = {82, 4, 3, 10, 55, 63, 138, 152, 76, 255, 119, 124, 115, 104, 160};

//: session_snapchat_self_readed
Byte kMusicValue[] = {60, 28, 96, 4, 211, 197, 211, 211, 201, 207, 206, 191, 211, 206, 193, 208, 195, 200, 193, 212, 191, 211, 197, 204, 198, 191, 210, 197, 193, 196, 197, 196, 53};

// __DEBUG__
// __CLOSE_PRINT__
//
//  SnapchatAttachment.m
//  NIM
//
//  Created by amao on 7/2/15.
//  Copyright (c) 2015 Netease. All rights reserved.
//

// __M_A_C_R_O__
//: #import "RunViewportOutsideSwatch.h"
#import "RunViewportOutsideSwatch.h"
//: #import "DigestSpherePlayWidescreenWindow.h"
#import "DigestSpherePlayWidescreenWindow.h"
//: #import "NSData+ArrayZoomShaderDispatch.h"
#import "NSData+ArrayZoomShaderDispatch.h"
//: #import "DigestShimmeringSilentVisitor.h"
#import "DigestShimmeringSilentVisitor.h"

//: @interface RunViewportOutsideSwatch()
@interface RunViewportOutsideSwatch()

//: @property (nonatomic,assign) BOOL isFromMe;
@property (nonatomic,assign) BOOL compareExtra;

//: @end
@end

//: @implementation RunViewportOutsideSwatch
@implementation RunViewportOutsideSwatch

//: - (void)setIsFromMe:(BOOL)isFromMe{
- (void)setCompareExtra:(BOOL)isFromMe{
    //: if (_isFromMe != isFromMe) {
    if (_compareExtra != isFromMe) {
        //: _isFromMe = isFromMe;
        _compareExtra = isFromMe;
        //: [self updateCover];
        [self gentle];
    }
}

//: - (BOOL)canBeForwarded
- (BOOL)readDisplay
{
    //: return NO;
    return NO;
}

//: #pragma mark - https
#pragma mark - https
//: - (NSString *)url
- (NSString *)must
{
    //: return [_url length] ?
    return [_must length] ?
    //: [[[NIMSDK sharedSDK] resourceManager] normalizeURLString:_url] : nil;
    [[[NIMSDK sharedSDK] resourceManager] normalizeURLString:_must] : nil;
}


//: - (void)setIsFired:(BOOL)isFired{
- (void)setCompound:(BOOL)isFired{
    //: if (_isFired != isFired) {
    if (_compound != isFired) {
        //: _isFired = isFired;
        _compound = isFired;
        //: [self updateCover];
        [self gentle];
    }
}


//: - (CGSize)contentSize:(NIMMessage *)message cellWidth:(CGFloat)width{
- (CGSize)lastJoin:(NIMMessage *)message skirt:(CGFloat)width{
    //: self.isFromMe = message.isOutgoingMsg;
    self.compareExtra = message.isOutgoingMsg;
    //: CGSize size = self.showCoverImage.size;
    CGSize size = self.line.size;
    //: CGFloat customSnapMessageImageRightToText = 5;
    CGFloat customSnapMessageImageRightToText = 5;
    //: return CGSizeMake(size.width + customSnapMessageImageRightToText, size.height);
    return CGSizeMake(size.width + customSnapMessageImageRightToText, size.height);
}

//: - (void)setImageFilePath:(NSString *)path
- (void)setEveryday:(NSString *)path
{
    //: if ([[NSFileManager defaultManager] fileExistsAtPath:path]){
    if ([[NSFileManager defaultManager] fileExistsAtPath:path]){
        //: NSData *jpgData = nil;
        NSData *jpgData = nil;
        //: if ([path.pathExtension.uppercaseString isEqualToString:@"HEIC"]) {
        if ([path.pathExtension.uppercaseString isEqualToString:StringFromSubtle_Data(componentOwlDict)]) {
            //: CIImage *ciImage = [CIImage imageWithContentsOfURL:[NSURL fileURLWithPath:path]];
            CIImage *ciImage = [CIImage imageWithContentsOfURL:[NSURL fileURLWithPath:path]];
                                //: CIContext *context = [CIContext context];
                                CIContext *context = [CIContext context];
            //: jpgData = [context JPEGRepresentationOfImage:ciImage colorSpace:ciImage.colorSpace options:@{}];
            jpgData = [context JPEGRepresentationOfImage:ciImage colorSpace:ciImage.colorSpace options:@{}];
        //: } else {
        } else {
            //: jpgData = [NSData dataWithContentsOfFile:path];
            jpgData = [NSData dataWithContentsOfFile:path];
        }

        //: self.md5 = [jpgData MD5String];
        self.enter = [jpgData more];

        //: [jpgData writeToFile:[self filepath]
        [jpgData writeToFile:[self content]
               //: atomically:YES];
               atomically:YES];
     }
}

//: - (NSString *)attachmentPathForUploading
- (NSString *)attachmentPathForUploading
{
    //: return [self filepath];
    return [self content];
}

//: - (NSString *)filepath
- (NSString *)content
{
    //: NSString *filename = [_md5 stringByAppendingFormat:@".%@",(@"jpg")];
    NSString *filename = [_enter stringByAppendingFormat:@".%@",(StringFromSubtle_Data(colorShiftTitle))];
    //: return [DigestSpherePlayWidescreenWindow filepathForImage:filename];
    return [DigestSpherePlayWidescreenWindow constraintArchitecture:filename];
}

//: - (void)updateAttachmentURL:(NSString *)urlString
- (void)updateAttachmentURL:(NSString *)urlString
{
    //: self.url = urlString;
    self.must = urlString;
}

//: #pragma mark - 实现文件上传需要接口
#pragma mark - 实现文件上传需要接口
//: - (BOOL)attachmentNeedsUpload
- (BOOL)attachmentNeedsUpload
{
    //: return [_url length] == 0;
    return [_must length] == 0;
}



//: #pragma NIMCustomAttachment
#pragma NIMCustomAttachment
//: - (NSString *)encodeAttachment
- (NSString *)encodeAttachment
{
    //: NSMutableDictionary *dict = [NSMutableDictionary dictionary];
    NSMutableDictionary *dict = [NSMutableDictionary dictionary];
    //: NSMutableDictionary *data = [NSMutableDictionary dictionary];
    NSMutableDictionary *data = [NSMutableDictionary dictionary];
    //: [dict setObject:@(BinderSaverNormalizePingLinkerTypeSnapchat) forKey:@"type"];
    [dict setObject:@(BinderSaverNormalizePingLinkerTypeSnapchat) forKey:StringFromSubtle_Data(componentCropID)];
    //: [data setObject:_md5?_md5:@"" forKey:@"md5"];
    [data setObject:_enter?_enter:@"" forKey:StringFromSubtle_Data(colorStarFormat)];
    //: [data setObject:@(_isFired) forKey:@"fired"];
    [data setObject:@(_compound) forKey:StringFromSubtle_Data(userDomeTimer)];
    //: if ([_url length])
    if ([_must length])
    {
        //: [data setObject:_url forKey:@"url"];
        [data setObject:_must forKey:StringFromSubtle_Data(cacheOutlineDate)];
    }
    //: [dict setObject:data forKey:@"data"];
    [dict setObject:data forKey:StringFromSubtle_Data(widgetUrbanDict)];

    //: NSData *jsonData = [NSJSONSerialization dataWithJSONObject:dict
    NSData *jsonData = [NSJSONSerialization dataWithJSONObject:dict
                                                   //: options:0
                                                   options:0
                                                     //: error:nil];
                                                     error:nil];

    //: return [[NSString alloc] initWithData:jsonData
    return [[NSString alloc] initWithData:jsonData
                                 //: encoding:NSUTF8StringEncoding];
                                 encoding:NSUTF8StringEncoding];
}


//: - (NSString *)cellContent:(NIMMessage *)message{
- (NSString *)fixed:(NIMMessage *)message{
    //: self.isFromMe = message.isOutgoingMsg;
    self.compareExtra = message.isOutgoingMsg;
    //: return @"LedgeVirtuousBrightValue";
    return @"LedgeVirtuousBrightValue";
}

//: - (void)setImage:(UIImage *)image
- (void)setTipCompose:(UIImage *)image
{
    //: NSData *data = UIImageJPEGRepresentation(image, 0.3);
    NSData *data = UIImageJPEGRepresentation(image, 0.3);
    //: NSString *md5= [data MD5String];
    NSString *md5= [data more];
    //: self.md5 = md5;
    self.enter = md5;

    //: [data writeToFile:[self filepath]
    [data writeToFile:[self content]
           //: atomically:YES];
           atomically:YES];
}

//: - (UIEdgeInsets)contentViewInsets:(NIMMessage *)message
- (UIEdgeInsets)untilSternColumn:(NIMMessage *)message
{
    //: CGFloat bubblePaddingForImage = 3.f;
    CGFloat bubblePaddingForImage = 3.f;
    //: CGFloat bubbleArrowWidthForImage = -4.f;
    CGFloat bubbleArrowWidthForImage = -4.f;
    //: if (message.isOutgoingMsg) {
    if (message.isOutgoingMsg) {
        //: return UIEdgeInsetsMake(bubblePaddingForImage,bubblePaddingForImage,bubblePaddingForImage,bubblePaddingForImage + bubbleArrowWidthForImage);
        return UIEdgeInsetsMake(bubblePaddingForImage,bubblePaddingForImage,bubblePaddingForImage,bubblePaddingForImage + bubbleArrowWidthForImage);
    //: } else {
    } else {
        //: return UIEdgeInsetsMake(bubblePaddingForImage,bubblePaddingForImage + bubbleArrowWidthForImage + 4, bubblePaddingForImage,bubblePaddingForImage);
        return UIEdgeInsetsMake(bubblePaddingForImage,bubblePaddingForImage + bubbleArrowWidthForImage + 4, bubblePaddingForImage,bubblePaddingForImage);
    }
}


//: - (BOOL)canBeRevoked
- (BOOL)noWarehouseWrite
{
    //: return YES;
    return YES;
}

//: - (UIImage *)showCoverImage
- (UIImage *)line
{
    //: if (_showCoverImage == nil)
    if (_line == nil)
    {
        //: [self updateCover];
        [self gentle];
    }
    //: return _showCoverImage;
    return _line;
}

//: #pragma mark - Private
#pragma mark - Private
//: - (void)updateCover{
- (void)gentle{
    //: UIImage *image;
    UIImage *image;
    //: if (!self.isFromMe) {
    if (!self.compareExtra) {
        //: if (self.isFired) {
        if (self.compound) {
            //: image = [UIImage imageNamed:@"session_snapchat_other_readed"];
            image = [UIImage imageNamed:StringFromSubtle_Data(k_radarEvent)];
        //: }else{
        }else{
            //: image = [UIImage imageNamed:@"session_snapchat_other_unread"];
            image = [UIImage imageNamed:StringFromSubtle_Data(styleMarkPlatform)];
        }
    //: }else{
    }else{
        //: if (self.isFired) {
        if (self.compound) {
            //: image = [UIImage imageNamed:@"session_snapchat_self_readed"];
            image = [UIImage imageNamed:StringFromSubtle_Data(kMusicValue)];
        //: }else{
        }else{
            //: image = [UIImage imageNamed:@"session_snapchat_self_unread"];
            image = [UIImage imageNamed:StringFromSubtle_Data(dataEpisodeAlert)];
        }
    }
    //: self.showCoverImage = image;
    self.line = image;
}

//: @end
@end

Byte * Subtle_DataToCache(Byte *data) {
    int logicTurn = data[0];
    int brilliant = data[1];
    Byte odd = data[2];
    int topic = data[3];
    if (!logicTurn) return data + topic;
    for (int i = topic; i < topic + brilliant; i++) {
        int value = data[i] - odd;
        if (value < 0) {
            value += 256;
        }
        data[i] = value;
    }
    data[0] = 0;
    data[topic + brilliant] = 0;
    return data + topic;
}

NSString *StringFromSubtle_Data(Byte *data) {
    return [NSString stringWithUTF8String:(char *)Subtle_DataToCache(data)];
}
